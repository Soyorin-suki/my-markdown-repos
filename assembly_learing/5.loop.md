# 循环指令与循环程序设计

## LOOP指令
- 通常可以使用LOOP指令来实现循环功能
- 指令格式: LOOP 标号
- 执行步骤
  - (CX)=(CX)-1;
  - 判断CX中的值，如果**不为零**则转至标号处执行，如果**为零**则继续向下执行

注：(CX)表示寄存器CX中的值

## 如何使用LOOP指令
- 首先在CX中设置循环次数
- LOOP指令对应的标号所标识的地址要在LOOP指令前面
- 需要循环执行的程序段，应该写在标号和LOOP指令中间

## 应用例一
不使用乘法指令，计算123*236，结果存放在AX中。
```assembly
ASSUME CS:code
code SEGMENT
START:	MOV AX,0
	MOV CX,236
LOOP1:	ADD AX,123
	LOOP LOOP1

	MOV AX,4C00H
	INT 21H
code ENDS
END START
```
## 应用例二
计算FFFF:0006单元中的数据乘以3，结果存放在DX中
```assembly
ASSUME CS:code,DS:data
;---------------
data SEGMENT

data ENDS
;---------------
code SEGMENT
START:	MOV AX,0FFFFH
		MOV DS,AX
		MOV BX,6
		MOV AL,[BX]
		MOV AH,0
		MOV DX,0
		MOV CX,3
LOOP1:	ADD DX,AX
		LOOP LOOP1
		MOV AX,4C00H
		INT 21H
code ENDS
END START
```
## MASM编译器对指令的特殊处理
- `MOV AL,[6]`表示将DS:0006处的数据送入AL中
- 但是在汇编源程序中，指令`MOV AL,[6]`会被编译器当做指令`MOV AL,6`处理
- 针对这种情况，通常利用寄存器BX存储内存单元的偏移地址，并使用`[BX]`格式进行寻址

## 应用例三
```assembly
ASSUME CS:code,DS:data
;计算FFFF0H到FFFFBH单元中的数据的和，结果存入DX中
;-----------
data SEGMENT

data ENDS
;-----------
code SEGMENT
START:	MOV AX,0FFFFH
		MOV DS,AX
		MOV DX,0
		MOV BX,0
		MOV CX,0CH
LOOP1:	MOV AL,[BX]
		MOV AH,0
		ADD DX, AX
		INC BX
		LOOP LOOP1

		MOV AX,4C00H
		INT 21H
code ENDS
END START
```

## 应用例四
将内存FFFF:0~FFFF:B内存单元的数据拷贝到0:200~0~20B单元中


### 使用段前缀优化程序
- 源单元ffff:X和目标单元0020:X 相距大于64KB，在不同的64KB段里，程序中每次循环要设置两次ds，这样做虽然程序逻辑是正确的，但是效率不高； 
- 可以使用两个段寄存器分别存放源单元ffff:X和目标单元0020:X的段地址，这样就可以省略循环中需要重复做12次的设置ds的程序段。 
```assembly
ASSUME CS:code,DS:data
code SEGMENT
START:	
	MOV AX,0FFFFH
	MOV DS,AX
	MOV AX,0020H
	MOV ES,AX
	MOV BX,0
	MOV CX,12
LOOP1:	
	MOV DL,[BX]
	MOV ES:[BX],DL
	INC BX
	LOOP LOOP1

	MOV AX,4C00H
	INT 21H
code ENDS
END START
```

