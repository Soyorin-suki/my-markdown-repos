# 对顶堆
对顶堆是一种可以动态地维护一些临界值（前i个数字的中位数，前i个数字的第k大）的数据结构
对顶堆一般是一个小根堆维护一些状态，一个大根堆维护剩下的数字的状态
小根堆的元素都应该大于大根堆的元素，即小根堆里的最小元素（堆顶元素）应该大于大根堆里的最大元素（堆顶元素）
我们在对顶堆里插入一个元素的时间复杂度为$O(\log n)$，检查需要维护的值（中位数、第k大）的时间复杂度为$O(1)$


P1168 中位数
> 给定一个长度为$n$的序列$\{a\}$，对前奇数项求中位数
> $1\le n\le 1e5,1\le a_i\le 1e9$

```c++
priority_queue<ll,vector<ll>,greater<ll>>q1;//小根堆
priority_queue<ll,vector<ll>>q2;//大根堆
for(ll i=1;i<=n;++i){
	if(i&1LL){
		q2.push(a[i]);
		q1.push(q2.top());
		q2.pop();
	}else {
		q1.push(a[i]);
		q2.push(q1.top());
		q1.pop();
	}
	if(i&1LL){
		cout<<q1.top()<<endl;
	}
}
```
真正可行的对顶堆动态求前n个序列的第$[\frac{n}{2}]$大元素
来自2024icpc网络赛第一场G
```c++
priority_queue<int, vector<int>, greater<int>> q1;
priority_queue<int, vector<int> > q2;
for (int r = l; r <= n; r++) {
	q1.push(a[r]);
	while (!q1.empty() && !q2.empty() && q1.top() < q2.top()) {
		q2.push(q1.top());
		q1.pop();
	}
	while (q1.size() < (r - l + 1) / 2 + 1) {
		q1.push(q2.top());
		q2.pop();
	}
	while (q1.size() > (r - l + 1) / 2 + 1) {
		q2.push(q1.top());
		q1.pop();
	}
	b[l][r] = q1.top();
}
```
抄的medium板子：
来自2023icpc南京K
```c++
struct medium_solver{
	private:
	multiset<ll>A,B;
	ll SA,SB;
	public:
	//初始化
	void init(void){
		A.clear();B.clear();
		SA=SB=0;
	}
	//插入一个数x
	void insert(ll x){
		if(B.empty()){
			B.insert(x);SB+=x;return;
		}
		ll mid=*B.begin();
		if(x>=mid){
			B.insert(x);SB+=x;
			if(A.size()<B.size()-1){
				auto it=B.begin();SB-=*it,SA+=*it;
				A.insert(*it);B.erase(it);
			}
		}else {
			A.insert(x);SA+=x;
			if(A.size()>B.size()){
				auto it=(--A.end());SA-=*it,SB+=*it;
				B.insert(*it);A.erase(it);
			}
		}
	}
	//删除一个数x
	void remove(ll x){
		ll mid=*B.begin();
		if(x>=mid){
			B.erase(B.find(x));SB-=x;
			if(A.size()>B.size()){
				auto it=(--A.end());SA-=*it,SB+=*it;
				B.insert(*it);A.erase(it);
			}
		}
		else {
			A.erase(A.find(x));SA-=x;
			if(A.size()<B.size()-1){
				auto it=B.begin();SB-=*it,SA+=*it;
				A.insert(*it);B.erase(it);
			}
		}
	}
	//计算题中的某个值
	ll calc(void){
		ll mid=*B.begin();
		return (mid*A.size()-SA)+(SB-mid*B.size());
	}
}s;
```
