# 博弈论
## 三种典型博弈论问题
### 巴什博奕(bash game)
> 巴什博奕是类似于这样的问题：
> 两个顶尖聪明的人在玩游戏，有$n$个石子，每人可以随便拿$1-m$个石子，不能拿的人为败者，问谁会胜利

巴什博奕是博弈论问题的基础，是最简单的一种情形对应一种状态的问题
分析后可发现
- 当$1\le n\le m$时先手必胜
- 当$n=m+1$时先手无论拿几个，后手都可以拿干净，先手必输
- 当$m+1\lt n\le 2m$时先手可以拿走一部分使得剩下的只有$m+1$个，因此先手必胜

拓展后可以发现：
- 当$n=k*(m+1)$时，无论先手拿几个(x)，后手都可以拿走一部分(m+1-x)使得剩下的$n=(k-1)*(m+1)$
- 当$n=k*(m+1)+x$时先手可以拿走x个，这样先手必胜
___
### 尼姆博弈(Nim game)
> 尼姆博弈是类似于这样的问题：
> 两个顶尖聪明的人在玩游戏，有$n$堆石子，第$i$堆有$a_i$个，每人每次能从一堆石子中取任意多个石子但不能不取，不能拿的人输，问谁会赢

尼姆博弈是巴什博奕的升级版，不再是一个简单的状态，因此分析起来难很多
#### 博弈分析
先从简单的情况入手：
- $n=1$时先手必胜
- $n=2,a_1=a_2$时后手必胜
- $n=2,a_1\ne a_2$时不妨假设$a_1>a_2$，先手在第一堆里拿$a_1-a_2$个，之后就是上面那一种情况了，所以先手必胜

但是当$n\ge 3$时呢？
问题就变得繁琐起来，此时就需要有一个有规律的结论
#### 结论
当$a_1\oplus a_2\oplus \dots \oplus a_n=0$时先手必败，否则先手必胜
**证明：**
假设当前异或和为0，此时先手在第i堆取了若干个，使得局势变成了$a_1\oplus a_2\oplus \dots \oplus a_i'\oplus \dots \oplus a_n=k$
假设k的最高位1在x位上，那么一定有一个数$a_j$可以使得$a_j$的第x位是1
我们只需要将$a_j$变为$a_j\oplus k$即可使得异或和再次变为0
后手一直这样取，直到$a_1=a_2=\dots =a_n=0$时先手输掉

那么能否每次都存在$a_j$使得$a_j$变成$a_j\oplus k$呢
答案是存在的，可以用异或想一想
因为$a_j\oplus k$后的x位异或为0，一旦异或即会变小，也就是说我们每次只需要取第j堆的$a_j-(a_j\oplus k)$即可

**EX:nim-k游戏**
假如每个人可以在最多d堆里取任意多石头，又该如何判断呢？
这个游戏实际上是nim游戏的拓展版
#### 结论
将每一堆石头用二进制表示，对于二进制的每一位，如果这一位为1的堆的数量$\%(1+d)$都为0，那么先手必输，否则先手必赢

**证明：**
与nim游戏的证明类似，我们只需要证明以下三点：
1. 终止局面为先手必败
2. 任意先手必胜的局面都能转化为先手必败的局面
3. 任意先手必败的局面都不能转化为先手必败的局面

第一点显然
第二点：与nim游戏的证明类似，我们可以使所有$\%(d+1)$不等于0的位变为0，此后就将二进制的每一位中这一位为1的堆的数量转化为了$\%(1+d)=0$因此将先手必胜局面转化为了先手必败局面
第三点:因为每一位中这一位为1的堆数$\%(1+d)=0$而最多只能取d个堆，因此任意先手必败的局面都不能转化为先手必败的局面

___
### 威佐夫博弈
> 威佐夫博弈是类似于这样的问题：
> 两个顶尖聪明的人在玩游戏，有2堆石子，每人每次可以取走某一堆中的任意数量的石子，或在两堆里取走相同数量的石子，不能拿的人输，问谁会赢

待定

**EX:扩展威佐夫博弈**

待定


___
**重要：**
## SG函数
### 组合游戏
我们研究的博弈问题到底是什么，是一类怎样的问题？
我们要研究的是一类叫做**公平组合游戏(Impartial Game/Impartial Combinatorial Games/ICG)**
什么是**公平组合游戏**
- 两个人进行博弈
- 两人轮流进行决策且做出的决策都对自己有利
- 游戏中同一个局势不能多次到达且游戏没有平局
- 当有人无法做出决策时，无法做出决策的人输
- 游戏可以在有限步数内结束
- 任意游戏者在某一决策时做出的决策只与当前局势有关，与游戏者无关
> **非公平组合游戏**与公平组合游戏的区别主要在于游戏者在某一确定状态做出的决策与游戏者有关，大部分的棋类游戏都**不是**公平组合游戏
> **反常游戏**是**按照**ICG的规则进行，但是**胜者是最后一个无法行动的玩家**

### 必胜态和必败态
定义$P-position$和$N-position$
$P-position$：必败态（简称$P$），即在决策前处于这种状态的人必败
$N-position$：必胜态（简称$N$），即在决策前处于这种状态的人必胜
严谨的定义：
1. 无法移动的状态为$P$
2. 可以移动到$P$的状态为$N$
3. 任意移动都会到$N$的状态为$P$

**组合游戏的DAG图**
如果将每一种状态向它能到达的状态连边，那么一个组合游戏所有的状态就能组成一个DAG
**给出一张DAG，在给定起点处有一颗棋子，两个人轮流移动棋子，如果谁不能移动了就判输**
所有的公平组合游戏都可以抽象成以上模型

### SG函数和SG定理
定义$MEX$运算为一个集合中没有出现的最小非负整数
SG函数描述的是博弈中某个状态量化后的值，$SG(x)=mex\{SG(y)|x\ can\ go\ to\ y\}$
```c++
int mex(auto v) // v可以是vector、set等容器 
{
    unordered_set<int> S;
    for (auto e : v)
        S.insert(e);
    for (int i = 0;; ++i)
        if (S.find(i) == S.end())
            return i;
}
```
$SG$函数具有以下性质：
1. 终止状态$SG$值为0，因为它没有出边(可到达的状态)
2. $SG$函数值为0的状态为必败态，因为它的后继状态$SG$值都不为0，满足必败态定义
3. $SG$值不为0的状态为必胜态，它的后继状态$SG$有0的状态，满足必胜态定义

由此我们可以知道了对于尼姆博弈每一堆的$SG$值就是它的石子数，而尼姆博弈的判断方式是查看石子数的异或和是否为0，那么其他ICG是否用类似的结论判断呢？
### SG定理(Sprague-Grundy定理)
**SG定理：游戏的和为每个单一游戏SG值的异或和**
> 单一游戏就是原游戏的子游戏，例如尼姆博弈中的一堆石子
> 定义若干个ICG的组合为这样一个游戏：每位玩家每个回合在这若干个ICG（称为子游戏）中选择一个，对它进行一次操作；当所有子游戏都无法进行操作时，当前玩家输掉游戏。记两个ICG的状态分别为$x$和$y$，则记这两个ICG的组合的状态为$x+y$
> 那么(两个游戏时)$SG(x+y)=SG(x)\oplus SG(y)$

证明与尼姆游戏的证明类似：
所有终止状态的SG值都是0，如果每次先手是本来SG值异或值为0的局面变成了k，那么后手一定可以找到一个单一游戏使得它的SG值变为0，
那么SG值怎么求：按照定义，依次枚举每种状态并枚举每种状态能够到达的状态，找到每个状态后继状态SG值中没有出现的最小自然数就是它的SG值





___
## 其他博弈
### 对称博弈
没有特定的描述，类似一种思想(似乎用到了零和思维)，一般数据都是首尾相连的一个环
例题：HDU C 3951 Coin Game
> 两个玩家用一圈N个硬币开始游戏。他们轮流从圆圈里取硬币，每次可以取1~k个连续的硬币。（假设10个硬币从1到10，k等于3，因为1和10是连续的，你可以拿走连续的10、1、2，但是如果2被拿走，你不能拿走1、3、4，因为1和3不是连续的）。拿最后一枚硬币的玩家获胜。
> $3\le N\le 1e9,1\le K\le 10$


### Anti-SG与SJ定理
> anti-SG组合游戏的其他规则与SG组合游戏规则相同，但它规定集合为空者获胜
> anti-nim博弈：
> 两个顶尖聪明的人在玩游戏，有$n$堆石子，第$i$堆有$a_i$个，每人每次能从一堆石子中取任意多个石子但不能不取，取到最后一个的人输，请问先手与后手谁必胜？

我们可以发现先手必胜有两种情况：
1. 每堆石头的异或和不为0且至少有一堆石头数量大于1
2. 每堆石头的异或和为0且每堆石头的数量都是1

第二种情况显然
对于第一种情况我们先除去偶数个石头数量为1的堆(异或和不变且不改变先后手关系，且一定会轮番取完)，先手只需要一次使得石头堆异或值为0，后面每次后手改变异或值就再次改变回去即可，到最后一定会只剩下两堆数量大于1且数量相等的石头，最后可以发现后手先取任何情况先手都可以获胜（省略）

我们也可以将anti-nim游戏推广成anti-SG组合游戏
即SJ定理
**对于anti-SG游戏，先手必胜当且仅当：**
**1. 游戏的和不为0，且至少有一个单一游戏的SG值大于1**
**2. 游戏的和为0，且所有单一游戏的SG值不大于1**
证明与SG定理类似

### multi-SG
multi-SG游戏的规则与SG类似，但多出一个可以将单一游戏分解成多个单一游戏的操作。对于分裂单一游戏的操作，分裂后的状态的SG值可以看做分裂出来的单一游戏的异或和
看一下multi-nim游戏：
> 两个顶尖聪明的人在玩游戏，有$n$堆石子，第$i$堆有$a_i$个，每人每次能从一堆石子中取任意多个石子但不能不取，或者可以把其中一堆不少于2的石头分成两堆，取到最后一个的人赢，请问先手与后手谁必胜？

（待定）
### every-SG
（待定）


___
参考：
[巴什博奕] (https://www.cnblogs.com/zwfymqz/p/8460192.html)
[博弈论学习中的一个总结] (https://fangkaipeng.com/?p=111)
[简单易懂的博弈论讲解(巴什博弈、尼姆博弈、威佐夫博弈、斐波那契博弈、SG定理)] (https://www.cnblogs.com/Khada-Jhin/p/9609561.html)
[博弈专题入门总结（Nim，巴什 SG等证明+例题）] (https://fangkaipeng.com/?p=111)
[常见的博弈论专题详解（附有例题）] (https://blog.csdn.net/m0_73557680/article/details/130809322?spm=1001.2101.3001.6650.1&utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromBaidu%7ECtr-1-130809322-blog-89318447.235%5Ev43%5Epc_blog_bottom_relevance_base4&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromBaidu%7ECtr-1-130809322-blog-89318447.235%5Ev43%5Epc_blog_bottom_relevance_base4&utm_relevant_index=2)
[oiwiki相关页面] (https://oi-wiki.org/math/game-theory/intro/)
[算法学习笔记(51)SG函数] (https://zhuanlan.zhihu.com/p/257013159)